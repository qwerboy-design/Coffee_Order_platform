# 訂單功能自動化測試

## 快速開始

### 1. 啟動開發伺服器

```bash
npm run dev
```

確保伺服器在 `http://localhost:3000` 運行。

### 2. 執行測試

在新的終端視窗中執行：

```bash
npm run test:order
```

或者：

```bash
npx tsx scripts/test-order.ts
```

### 3. 查看測試結果

測試會自動執行並顯示結果：

- ✓ 綠色：測試通過
- ✗ 紅色：測試失敗
- ℹ 藍色：測試資訊

## 測試內容

測試腳本會驗證以下功能：

1. ✅ **獲取可用產品（資料庫）** - 直接從 Airtable 獲取有庫存的產品
2. ✅ **獲取可用產品（API）** - 通過 `/api/products` API 獲取產品
3. ✅ **直接創建訂單（資料庫）** - 直接調用 `createOrder` 函數創建訂單
4. ✅ **通過 API 創建訂單** - 通過 `/api/orders` API 創建訂單
5. ✅ **驗證訂單數據** - 驗證訂單是否正確寫入資料庫

## 測試數據

測試會創建以下測試數據：

- **客戶名稱**: `測試客戶_[時間戳]`
- **電話**: 隨機生成的台灣手機號碼格式
- **Email**: `test_[時間戳]@example.com`
- **訂單備註**: "自動化測試訂單"

## 注意事項

⚠️ **重要**：此測試會在 Airtable 中創建真實的訂單記錄，請在測試環境中使用。

- 測試會實際扣除產品庫存
- 測試會創建或更新客戶記錄
- 測試創建的訂單狀態為 `pending`

## 故障排除

### 錯誤：沒有可用的產品

確保 Airtable 的 Products 表中有至少一個：
- `is_active` 為 `true` 的產品
- `stock` 大於 0 的產品

### 錯誤：API 回應狀態碼 500

檢查：
1. 開發伺服器是否正在運行（`npm run dev`）
2. 環境變數是否正確設置（`.env.local`）
3. Airtable API Key 是否有寫入權限
4. Airtable Base ID 是否正確

### 錯誤：創建訂單失敗

檢查：
1. Airtable 表結構是否正確（參考 `SETUP.md`）
2. 產品 ID 是否存在
3. 庫存是否足夠

## 詳細說明

更多詳細說明請參考 `scripts/README.md`。

